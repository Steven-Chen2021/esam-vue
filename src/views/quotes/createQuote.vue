<script setup lang="ts">
import {
  deleteChildren,
  getNodeByUniqueId,
  appendFieldByUniqueId
} from "@/utils/tree";
import { useDetail } from "./hooks";
import { ref, computed } from "vue";
import { clone } from "@pureadmin/utils";
import { transformI18n } from "@/plugins/i18n";
import { useMultiTagsStoreHook } from "@/store/modules/multiTags";
import { usePermissionStoreHook } from "@/store/modules/permission";
import {
  type PlusColumn,
  type FieldValues,
  PlusForm
} from "plus-pro-components";

const state = ref<FieldValues>({
  status: "0",
  name: "",
  rate: 4,
  progress: 100,
  switch: true,
  time: new Date().toString(),
  img: "https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"
});

const rules = {
  name: [
    {
      required: true,
      message: "请输入名称"
    }
  ],
  tag: [
    {
      required: true,
      message: "请输入标签"
    }
  ]
};

const columns: PlusColumn[] = [
  {
    label: "名称",
    width: 120,
    prop: "name",
    valueType: "copy",
    tooltip: "名称最多显示6个字符",
    colProps: {
      span: 8
    }
  },
  {
    label: "状态",
    width: 120,
    prop: "status",
    valueType: "select",
    options: [
      {
        label: "未解决",
        value: "0",
        color: "red"
      },
      {
        label: "已解决",
        value: "1",
        color: "blue"
      },
      {
        label: "解决中",
        value: "2",
        color: "yellow"
      },
      {
        label: "失败",
        value: "3",
        color: "red"
      }
    ],
    colProps: {
      span: 8
    }
  },
  {
    label: "标签",
    width: 120,
    prop: "tag",
    colProps: {
      span: 8
    }
  },
  {
    label: "执行进度",
    width: 200,
    prop: "progress",
    colProps: {
      span: 12
    }
  },
  {
    label: "评分",
    width: 200,
    prop: "rate",
    valueType: "rate",
    colProps: {
      span: 12
    }
  },
  {
    label: "是否显示",
    width: 100,
    prop: "switch",
    valueType: "switch",
    colProps: {
      span: 12
    }
  },
  {
    label: "图片",
    prop: "img",
    width: 100,
    valueType: "img",
    colProps: {
      span: 12
    }
  },
  {
    label: "时间",
    prop: "time",
    valueType: "date-picker",
    colProps: {
      span: 12
    }
  },
  {
    label: "数量",
    prop: "number",
    valueType: "input-number",
    fieldProps: { precision: 2, step: 2 },
    colProps: {
      span: 12
    }
  },
  {
    label: "城市",
    prop: "city",
    valueType: "cascader",
    options: [
      {
        value: "0",
        label: "陕西",
        children: [
          {
            value: "0-0",
            label: "西安",
            children: [
              {
                value: "0-0-0",
                label: "新城区"
              },
              {
                value: "0-0-1",
                label: "高新区"
              },
              {
                value: "0-0-2",
                label: "灞桥区"
              }
            ]
          }
        ]
      },
      {
        value: "1",
        label: "山西",
        children: [
          {
            value: "1-0",
            label: "太原",
            children: [
              {
                value: "1-0-0",
                label: "小店区"
              },
              {
                value: "1-0-1",
                label: "古交市"
              },
              {
                value: "1-0-2",
                label: "万柏林区"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    label: "地区",
    prop: "place",
    tooltip: "请精确到门牌号",
    fieldProps: {
      placeholder: "请精确到门牌号"
    }
  },
  {
    label: "要求",
    prop: "demand",
    valueType: "checkbox",
    options: [
      {
        label: "四六级",
        value: "0"
      },
      {
        label: "计算机二级证书",
        value: "1"
      },
      {
        label: "普通话证书",
        value: "2"
      }
    ]
  },
  {
    label: "梦想",
    prop: "gift",
    valueType: "radio",
    options: [
      {
        label: "诗",
        value: "0"
      },
      {
        label: "远方",
        value: "1"
      },
      {
        label: "美食",
        value: "2"
      }
    ],
    colProps: {
      span: 12
    }
  },
  {
    label: "到期时间",
    prop: "endTime",
    valueType: "date-picker",
    fieldProps: {
      type: "datetimerange",
      startPlaceholder: "请选择开始时间",
      endPlaceholder: "请选择结束时间"
    },
    colProps: {
      span: 12
    }
  },
  {
    label: "说明",
    prop: "desc",
    valueType: "textarea",
    fieldProps: {
      maxlength: 10,
      showWordLimit: true,
      autosize: { minRows: 2, maxRows: 4 }
    }
  }
];

const handleChange = (values: FieldValues) => {
  console.log(values, "change");
};
const handleSubmit = (values: FieldValues) => {
  console.log(values, "Submit");
};
const handleSubmitError = (err: any) => {
  console.log(err, "err");
};
const handleReset = () => {
  console.log("handleReset");
};

defineOptions({
  name: "CreateQuote"
});

const { toDetail, router } = useDetail();
const menusTree = clone(usePermissionStoreHook().wholeMenus, true);

const treeData = computed(() => {
  return appendFieldByUniqueId(deleteChildren(menusTree), 0, {
    disabled: true
  });
});

const currentValues = ref<string[]>([]);

const multiTags = computed(() => {
  return useMultiTagsStoreHook()?.multiTags;
});
</script>

<template>
  <el-card shadow="never" class="relative h-96 overflow-hidden">
    <!-- Top Section -->
    <div class="absolute top-0 left-0 right-0 bg-gray-300 text-white p-4">
      Top Content
    </div>

    <!-- Content Section -->
    <el-scrollbar max-height="1000" class="pt-14 h-full overflow-y-auto">
      <div class="p-4">
        <PlusForm
          v-model="state"
          :columns="columns"
          :rules="rules"
          :row-props="{ gutter: 20 }"
          @change="handleChange"
          @submit="handleSubmit"
          @submit-error="handleSubmitError"
          @reset="handleReset"
        />
      </div>
    </el-scrollbar>

    <!-- Footer Section -->
    <div class="absolute bottom-0 left-0 right-0 bg-gray-300 text-white p-4">
      Footer Content
    </div>
  </el-card>
</template>

<style scoped>
.el-card {
  position: relative;
  height: 100%;
}
</style>
